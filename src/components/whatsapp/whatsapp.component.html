<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold text-gray-800 mb-6">Conexión de WhatsApp</h1>

  @switch (whatsappService.status()) {
    @case ('initial') {
      <div class="bg-white p-8 rounded-lg shadow-md text-center">
         <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"></div>
        <p class="text-gray-600 mt-4">Cargando configuración...</p>
      </div>
    }
    @case ('needs-config') {
      <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md shadow-md" role="alert">
        <p class="font-bold">Configuración Requerida</p>
        <p>Por favor, ve a la página de <a routerLink="/settings" class="underline font-semibold">Configuración</a> para añadir los detalles de tu instancia de Evolution API.</p>
      </div>
    }
    @case ('disconnected') {
       <div class="bg-white p-8 rounded-lg shadow-md text-center">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Instancia Desconectada</h2>
        <p class="text-gray-600 mb-6">Tu instancia de WhatsApp está desconectada. Haz clic en el botón para generar un código QR y escanearlo con tu teléfono.</p>
        <button (click)="connect()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-colors">
          Conectar
        </button>
      </div>
    }
    @case ('connecting') {
      <div class="bg-white p-8 rounded-lg shadow-md text-center">
        @if (whatsappService.qrCodeString()) {
          <h2 class="text-2xl font-semibold text-gray-700 mb-4">Escanea el Código QR</h2>
          <p class="text-gray-600 mb-6">Abre WhatsApp en tu teléfono y escanea el siguiente código para conectar.</p>
          <div class="flex justify-center p-4 bg-gray-100 rounded-md">
            <canvas #qrCanvas width="256" height="256" class="border rounded-md"></canvas>
          </div>
        } @else {
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"></div>
          <p class="text-gray-600 mt-4">Generando código QR...</p>
        }
      </div>
    }
    @case ('connected') {
      <div class="bg-white p-8 rounded-lg shadow-md text-center">
        <h2 class="text-2xl font-semibold text-green-600 mb-4">¡Conectado!</h2>
        <p class="text-gray-600 mb-6">Tu instancia de WhatsApp está conectada y lista para recibir mensajes.</p>
        <p class="text-sm text-gray-500 mb-6">Instancia: {{ whatsappService.instance()?.instanceName }}</p>
        <button (click)="disconnect()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-colors">
          Desconectar
        </button>
      </div>
    }
    @case ('error') {
      <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md" role="alert">
        <p class="font-bold">Error de Conexión</p>
        <p>No se pudo conectar con la instancia de WhatsApp. Verifica tu configuración e inténtalo de nuevo.</p>
      </div>
    }
  }
</div>
